<apex:page standardController="BZP__PayPeriod__c" extensions="PayrollDetailsController_V2" action="{!getAggre}" sidebar="false" renderAs="pdf" contentType="text/plain" applyBodyTag="false" readonly="true">
    <head> 
        <style type="text/css" media="print">
            table 
            { 
            page-break-inside: avoid !important;
            border: 0px #ddd solid;
            }
            td { 
            vertical-align:top;
            padding:5px 5px;
            width :50px;
            page-break-inside: avoid !important;
            margin: 4px 0 4px 0;
            }
            .yearTable {
            position:relative;
            border-block-end: solid; writing-mode: horizontal-tb;
            text-align:right !important;
            }
            .yearTablees tr td{
            width:88%;
            font-size:11px; 
            text-align:left;
            padding: 0;
            
            }
                .yearTabls tr td{
                 
                font-size:11px; 
        display: table-cell;
        text-align: center;
        padding: 0 5px;
                padding: 0;
                
                }
            
            @page {
            margin-bottom: 3cm;
            size: A4 landscape;
            page-break-inside: avoid !important;
            @top-center {
            content: element(header);
            }
            @bottom-left {
            content: element(footer); 
            }
            }
            div.header {
            padding: 5px;
            position: running(header);
            }
            div.footer {
            display: block;
            padding: 5px;
            position: running(footer);
            }
            .pagenumber:before {
            content: counter(page);
            }
            .pagecount:before {
            content: counter(pages);
            }
        </style> 
               
    </head> 
    <body> 
        <apex:variable value="{!0}" var="count"/>
        <apex:variable var="thours" value="{!0}"/>
        <apex:variable var="tearning" value="{!0}"/>
        <apex:variable var="tearningnon" value="{!0}"/>
        <apex:variable var="ttaxes" value="{!0}"/>
        <apex:variable var="tdeductions" value="{!0}"/>
        <apex:variable var="tnetpay" value="{!0}"/>
        <apex:variable var="temployer" value="{!0}"/>
        
        <div class="footer" >
            <div align="center" style="font-size:11px;">Page <span class="pagenumber"/> of <span class="pagecount"/></div>
            <div style="font-size:11px; text-align: right;">
            Date Printed :&nbsp;<apex:outputText value="{0,date,MM/dd/yyyy hh:mm}" Style="font-size:11px;text-align:center; "><apex:param value="{!Now()}"/></apex:outputText>
            <br/> * Indicates Tax Refunded
            </div>
            <div style="font-size:11px; text-align: left">Company : Biznussoft Inc<br/>
                Check Date :&nbsp;<apex:outputText value="{0,date,MM/dd/yyyy}" Style="font-size:11px;text-align:center;padding-right:5px;"><apex:param value="{!BZP__PayPeriod__c.BZP__PayDate__c}"/></apex:outputText>-&nbsp;<apex:outputtext value="{!BZP__PayPeriod__c.name}" Style="font-size:11px;text-align:center;padding-right:5px;"/><br/>
                Pay Period :&nbsp;<apex:outputText value="{0,date,MM/dd/yyyy}" Style="font-size:11px;text-align:center;padding-right:5px;"><apex:param value="{!BZP__PayPeriod__c.BZP__PeriodBeginning__c}"/></apex:outputText>to&nbsp;<apex:outputText value="{0,date,MM/dd/yyyy}" Style="font-size:11px;text-align:center;padding-right:5px;"><apex:param value="{!BZP__PayPeriod__c.BZP__PeriodEnding__c}"/></apex:outputText></div>            
        </div>
        <div class="content">
            <center><h1 style="font-size:18px;">Payroll Details</h1></center>
            <table border="0"  width="100%" cellspacing="0" cellpadding="0" >
                
                <apex:variable var="rowNumber" value="{!0}"/>
                
                <apex:repeat value="{!Mapdeplist}" var="mapAccKey" >
                    <apex:variable var="rowCount" value="{!0}"/>     
                    <apex:variable var="hours" value="{!0}"/>
                    <apex:variable var="earning" value="{!0}"/>
                     <apex:variable var="earningnon" value="{!0}"/>
                    <apex:variable var="taxes" value="{!0}"/>
                    <apex:variable var="deductions" value="{!0}"/>
                    <apex:variable var="netpay" value="{!0}"/>
                    <apex:variable var="employer" value="{!0}"/>
                    
                   
                    
                    <div style="{!IF(count == 0, '','page-break-after:always;')}"> 
                        <table border="0"  width="100%" cellspacing="0" cellpadding="0"> 
                            <table border="1" cellspacing="0"  cellpadding="0"  width="100%" style="min-height:14px !important; "> 
                                
                                <table border="1" cellspacing="0"  cellpadding="0"  width="100%" style="min-height:14px !important;page-break-before:avoid; ">
                              <tr ><td class="header" colspan="9" Style="font-size:13px;">Pay Frequency :&nbsp;<apex:outputtext value="{!BZP__PayPeriod__c.BZP__PaySchedule__r.Name}" Style="font-size:13px;text-align:center;padding-right:5px;"/><br/> Project :&nbsp;<apex:outputtext value="{!mapAccKey.Name}" Style="font-size:13px;text-align:center;padding-right:5px;"/><br/> <!--Employee :&nbsp;<apex:outputtext value="{!BZP__PayPeriod__c.Name}" Style="font-size:13px;text-align:center;padding-right:5px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SSN : &nbsp;<apex:outputtext value="{!BZP__PayPeriod__c.Name}" Style="font-size:13px;text-align:center;padding-right:5px;"/>--> </td></tr>        

                                    <tr style=" page-break-inside: avoid;" class="header">
                                        <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Name</th>
                                        <th  align="center"   bgcolor="#00245F" style="color:white; font-size:14px;">Rate</th>
                                        <th  align="center"   bgcolor="#00245F" style="color:white; font-size:14px;">Hours</th>
                                        <th  align="center"   bgcolor="#00245F" style="color:white; font-size:14px;">Taxable Earnings  </th>
                                        <th  align="center"   bgcolor="#00245F" style="color:white; font-size:14px;">Non Taxable Earnings  </th>
                                        <th  align="center"   bgcolor="#00245F" style="color:white; font-size:14px;">Taxes</th>
                                        <th  align="center"   bgcolor="#00245F" style="color:white; font-size:14px;">Deductions</th>
                                        <th  align="center" width="8%" bgcolor="#00245F" style="color:white; font-size:14px;">Net Pay</th>
                                        <th  align="center"  bgcolor="#00245F" style="color:white; font-size:14px;">Employer</th> 
                                    </tr>
                                    <apex:repeat value="{!Mapdeplist[mapAccKey]}" var="pp" > 
                                        <apex:variable var="rowNumber" value="{!rowNumber+1}"/> 
                                        <apex:variable var="rowCount" value="{!rowCount+1}"/> 
                                        <apex:variable var="netpay" value="{!netpay+pp.BZP__NetPay__c}"/>                       
                                        <tr style="border-bottom:none;">
                                            <td width="20%" Style="font-size:11px;vertical-align:top;padding-right:5px;border-bottom:none;border-right:none;border-left:nome;">{!pp.BZP__Worker__r.Name}</td>
                                            <td class="yearTablees" style="border-bottom:none;border-right:none;border-left:nome;">
                                                <apex:repeat value="{!pp.BZP__Earnings__r}" var="ear" >
                                                    <apex:dataTable value="{!ear}" var="t" rendered="{!If(ear.BZP__PayStub__c==pp.id && ear.BZP__NonTaxable__c ==false,true,false) }">
                                                        <apex:column width="20%" Style="font-size:11px;text-align:right;padding-right:5px;">
                                                            <apex:outputText value="{0, Number, Currency}">
                                                                <apex:param value="{!t.BZP__Rate__c}" />
                                                            </apex:outputText>
                                                        </apex:column>
                                                    </apex:dataTable>
                                                </apex:repeat>
                                            </td>
                                            <td class="yearTabls " style="border-bottom:none;border-right:none;border-left:nome;text-align: right;">
                                                <apex:variable var="myhr" value="{!0}"/>
                                                <apex:repeat value="{!pp.BZP__Earnings__r}" var="ear" >
                                                    <apex:variable var="hours" value="{!if(ear.BZP__Hours__c!=null,hours+ear.BZP__Hours__c,hours)}" rendered="{!If(ear.BZP__PayStub__c==pp.id && ear.BZP__Hours__c !=null,true,false) }" />
                                                    <apex:variable var="myhr" value="{!If(ear.BZP__PayStub__c==pp.id && ear.BZP__Hours__c !=null && ear.BZP__NonTaxable__c ==false ,myhr+ear.BZP__Hours__c,myhr)}"/>
                                                    <apex:dataTable value="{!ear}" var="t" rendered="{!If(ear.BZP__PayStub__c==pp.id && ear.BZP__Hours__c !=null && ear.BZP__NonTaxable__c ==false,true,false) }">
                                                        <apex:column value="{!t.BZP__Hours__c}" width="20%" Style="font-size:11px;text-align:right;padding-right:5px;"/>
                                                    </apex:dataTable>
                                                </apex:repeat>
                                                <hr/>
                                                <table  style="vertical-align:bottom;">
                                                    <tbody>
                                                        <tr style="font-size:11px;">
                                                            <td style="font-size:11px;text-align:right">
                                                                <apex:outputText value="{!myhr}" />
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </td>
                                            <td class="yearTablees" style="border-bottom:none;border-right:none;border-left:nome;">
                                                <apex:variable var="myearn" value="{!0}"/>
                                                <apex:repeat value="{!pp.BZP__Earnings__r}" var="ear" >
                                                    
                                                    <apex:variable var="earning" value="{!earning+ear.BZP__Amount__c }" rendered="{!If(ear.BZP__PayStub__c==pp.id  && ear.BZP__NonTaxable__c ==false,true,false) }" />
                                                    
                                                    
                                                    
                                                    <apex:variable var="myearn" value="{!If(ear.BZP__PayStub__c==pp.id && ear.BZP__NonTaxable__c ==false,myearn+ear.BZP__Amount__c,myearn)}"/>
                                                    <apex:dataTable value="{!ear}" var="t" rendered="{!If(ear.BZP__PayStub__c==pp.id && ear.BZP__NonTaxable__c ==false ,true,false) }">
                                                        <apex:column value="{!t.Name}" width="20%" Style="font-size:11px;text-align:left;padding-right:5px;"/>
                                                        
                                                        <apex:column width="20%" Style="font-size:11px;text-align:right;padding-right:5px;">
                                                            <apex:outputText value="{0, Number, Currency}">
                                                                <apex:param value="{!t.BZP__Amount__c }" />
                                                            </apex:outputText>
                                                        </apex:column>
                                                    </apex:dataTable>
                                                    
                                                </apex:repeat>
                                                <hr/>
                                                <table  style="vertical-align:bottom;">
                                                    <tbody>
                                                        <tr style="font-size:11px;text-align:right;">
                                                            <td style="font-size:11px;"> </td>
                                                            <td style="font-size:11px;">
                                                                <apex:outputText value="{0, Number, Currency}">
                                                                    <apex:param value="{!myearn}" />
                                                                </apex:outputText>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </td><apex:variable var="myearnnontax" value="{!0}"/>
                                            <td class="yearTablees" style="border-bottom:none;border-right:none;border-left:nome;">
                                                
                                                <apex:repeat value="{!pp.BZP__Earnings__r}" var="ear" >
                                                    
                                                    <apex:variable var="earningnon" value="{!earningnon+ear.BZP__Amount__c }" rendered="{!If(ear.BZP__PayStub__c==pp.id && ear.BZP__NonTaxable__c ==true,true,false) }" />
                                                    
                                                    
                                                    
                                                    <apex:variable var="myearnnontax" value="{!If(ear.BZP__PayStub__c==pp.id && ear.BZP__NonTaxable__c ==true,myearnnontax+ear.BZP__Amount__c,myearnnontax)}"/>
                                                    <apex:dataTable value="{!ear}" var="t" rendered="{!If(ear.BZP__PayStub__c==pp.id && ear.BZP__NonTaxable__c ==true,true,false) }">
                                                        <apex:column value="{!t.Name}" width="20%" Style="font-size:11px;text-align:left;padding-right:5px;"/>
                                                        
                                                        <apex:column width="20%" Style="font-size:11px;text-align:right;padding-right:5px;">
                                                            <apex:outputText value="{0, Number, Currency}">
                                                                <apex:param value="{!t.BZP__Amount__c }" />
                                                            </apex:outputText>
                                                        </apex:column>
                                                    </apex:dataTable>
                                                    
                                                </apex:repeat>
                                                <hr/>
                                                <table  style="vertical-align:bottom;">
                                                    <tbody>
                                                        <tr style="font-size:11px;text-align:right;">
                                                            <td style="font-size:11px;"> </td>
                                                            <td style="font-size:11px;">
                                                                <apex:outputText value="{0, Number, Currency}">
                                                                    <apex:param value="{!myearnnontax}" />
                                                                </apex:outputText>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </td>
                                            <td class="yearTablees" style="border-bottom:none;border-right:none;border-left:nome;">
                                                <apex:repeat value="{!MapTaxvf[mapAccKey]}" var="tax" >
                                                    
                                                    
                                                    
                                                    <apex:variable var="taxes" value="{!taxes+tax.BZP__TaxAmount__c}" rendered="{!If(tax.BZP__PayStub__c== pp.id && tax.BZP__EmployerTaxLiability__c ==false,true,false) }"/>
                                                    <apex:dataTable value="{!tax}" var="t" rendered="{!If(tax.BZP__PayStub__c== pp.id && tax.BZP__EmployerTaxLiability__c ==false,true,false) }">
                                                        
                                                        <apex:column value="{!If(t.Refunded__c==true,t.Name +' *',t.Name)} " width="20%" Style="font-size:11px;text-align:left;padding-left:2px;"/>
                                                        
                                                        <apex:column width="20%"  style="font-size:11px;text-align:right;padding-right:2px;">
                                                            <apex:outputText value="{0, Number, Currency}">
                                                                <apex:param value="{!t.BZP__TaxAmount__c}" />
                                                            </apex:outputText>
                                                        </apex:column>
                                                    </apex:dataTable>
                                                </apex:repeat>
                                            </td>
                                            <td class="yearTablees " style="border-bottom:none;border-right:none;border-left:nome;">
                                                <apex:repeat value="{!MapDeductionvf[mapAccKey]}" var="ded" >
                                                    
                                                    
                                                    
                                                    <apex:variable var="deductions" value="{!deductions+ded.BZP__Amount__c }" rendered="{!If(ded.BZP__PayStub__c==pp.id ,true,false)}"/>
                                                    <apex:dataTable value="{!ded}" var="t" rendered="{!If(ded.BZP__PayStub__c==pp.id ,true,false)}">
                                                        <apex:column value="{!t.Name}" width="20%" Style="font-size:11px;vertical-align:top;padding-left:2px;"/>
                                                        <apex:column width="20%"   Style="font-size:11px;vertical-align:top;padding-right:2px;">
                                                            <apex:outputText value="{0, Number, Currency}">
                                                                <apex:param value="{!t.BZP__Amount__c }" />
                                                            </apex:outputText>
                                                        </apex:column>
                                                    </apex:dataTable>
                                                </apex:repeat>
                                            </td>
                                            <td width="20%" Style="font-size:11px;text-align:right;padding-right:15px;border-bottom:none;border-right:none;border-left:nome;">
                                            <apex:variable var="netpayin" value="{!pp.BZP__NetPay__c-myearnnontax}"/>
                                                <apex:outputText value="{0, Number, Currency}">
                                                    <apex:param value="{!netpayin}" />
                                                </apex:outputText><br/>
                                                <apex:outputText value="{0, Number, Currency}">
                                                    <apex:param value="{!myearnnontax}" />
                                                </apex:outputText>
                                                 <hr/>
                                                
                                                                <apex:outputText value="{0, Number, Currency}">
                                                                    <apex:param value="{!pp.BZP__NetPay__c}" />
                                                                </apex:outputText>
                                                           
                                            </td> 
                                            
                                            <td class="yearTablees " style="border-bottom:none;border-right:0.5mm dashed grey;border-left:nome;">
                                                <apex:repeat value="{!MapEmpvf[mapAccKey]}" var="tax" >
                                                    
                                                    <apex:variable var="employer" value="{!employer+tax.BZP__TaxAmount__c}" rendered="{!If(tax.BZP__PayStub__c== pp.id && tax.BZP__EmployerTaxLiability__c ==true,true,false) }"/>
                                                    <apex:dataTable value="{!tax}" var="t" rendered="{!If(tax.BZP__PayStub__c== pp.id && tax.BZP__EmployerTaxLiability__c ==true,true,false) }">
                                                        <apex:column value="{!t.Name}" width="20%" style="font-size:11px;vertical-align:top;padding-left:2px;"/>
                                                        
                                                        <apex:column width="20%"   style="font-size:11px;vertical-align:top;text-align:right;text-align-last:right;padding-right:2px">
                                                            <apex:outputText value="{0, Number, Currency}">
                                                                <apex:param value="{!t.BZP__TaxAmount__c}" />
                                                            </apex:outputText>
                                                        </apex:column>
                                                    </apex:dataTable>
                                                </apex:repeat><br/>
                                            </td>
                                        </tr>
                                         <tr >
                                        <td  style="font-size:11px;border-top: 0.5mm dashed grey;" colspan="9" >
                                                                <apex:repeat value="{!pp.BZP__Deposits__r}" var="dep" >
                                                                    <apex:dataTable value="{!dep}" var="d" rendered="{!If(dep.BZP__PayStub__c== pp.id,true,false)}" cellspacing="0"  cellpadding="0" >
                                                                    <apex:column colspan="2" style="text-align:center;padding: 0;">  
                                                                       <apex:outputText value="Check Date: {0,date,MM/dd/yyyy}     /">
                                                                        <apex:param value="{!BZP__PayPeriod__c.BZP__PayDate__c}" />
                                                                    </apex:outputText>  
                                                                    </apex:column>  
                                                                    <apex:column colspan="2" style="text-align:center;padding: 0;">  
                                                                         <apex:outputText value="   {!pp.BZP__WorkerPaymentMethod__c}     /"/> 
                                                                    </apex:column>  
                                                                    <apex:column colspan="2" style="text-align:center;padding: 0;">  
                                                                         <apex:outputtext value="Acc No :****{!RIGHT(d.BZP__AccountNumber__c,4)}     /"/>  
                                                                    </apex:column>  
                                                                    <apex:column colspan="2" style="text-align:center;padding: 0;">  
                                                                         <apex:outputText value="{0, Number, Currency}">
                                                                        <apex:param value="{!d.BZP__DepositAmount__c}" />
                                                                    </apex:outputText>  
                                                                    </apex:column> 
                                                                    </apex:dataTable>   
                                                            </apex:repeat>
                                            </td>
                                       </tr>
                                    </apex:repeat>
                                </table>
                            </table>
                        </table>
                        
                    <table border="1" cellspacing="0"  cellpadding="0"  width="100%" style="min-height:14px !important; background-color: #D3D3D3;table-layout: fixed;" >
                        
                     <tr ><td class="header" colspan="7" Style="font-size:13px;">Total Of Project :&nbsp;<apex:outputtext value="{!mapAccKey.Name}" Style="font-size:13px;text-align:center;padding-right:5px;"/><br/> No Of Workers :&nbsp;<apex:outputtext value="{!rowCount}" Style="font-size:13px;text-align:center;padding-right:5px;"/><br/> </td></tr>        

                        <tr style=" page-break-inside: avoid;" >
                            <!--<th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Count</th>-->
                            <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Hours </th>
                            <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Taxable Earnings  </th>
                             <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Non Taxable Earnings   </th>
                            <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Taxes</th>
                            <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Deductions </th>
                            <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Net Pay </th>
                            <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Employers</th>
                        </tr>
                       <tr>
                                            
                                           
                                            <td class="yearTablees" >
                                                <apex:repeat value="{!MapDepEarningvf[mapAccKey]}" var="ear" >
                                                    <apex:dataTable value="{!ear}" var="t" >
                                                        <apex:column value="{!t.Earning_Name__c}" width="20%" Style="font-size:11px;text-align:left;padding-right:5px;"/>
                                                        <apex:column value="{!t.Hours__c}" width="20%" Style="font-size:11px;text-align:right;padding-right:5px;"/>
                                                    </apex:dataTable>
                                                </apex:repeat>
                                            </td>
                                            <td class="yearTablees" >
                                                <apex:repeat value="{!MapDepEarningvf[mapAccKey]}" var="ear" >
                                                    <apex:dataTable value="{!ear}" var="t" rendered="{!If(ear.Non_Taxable__c== false,true,false)}">
                                                        <apex:column value="{!t.Earning_Name__c}" width="20%" Style="font-size:11px;text-align:left;padding-right:5px;"/>
                                                        <apex:column width="20%" Style="font-size:11px;text-align:right;padding-right:5px;">
                                                            <apex:outputText value="{0, Number, Currency}">
                                                                <apex:param value="{!t.Amount__c }" />
                                                            </apex:outputText>
                                                        </apex:column>
                                                    </apex:dataTable>
                                                </apex:repeat>
                                            </td>
                                            <td class="yearTablees" >
                                                <apex:repeat value="{!MapDepEarningvf[mapAccKey]}" var="ear" >
                                                    <apex:dataTable value="{!ear}" var="t" rendered="{!If(ear.Non_Taxable__c== true,true,false)}">
                                                        <apex:column value="{!t.Earning_Name__c}" width="20%" Style="font-size:11px;text-align:left;padding-right:5px;"/>
                                                        <apex:column width="20%" Style="font-size:11px;text-align:right;padding-right:5px;">
                                                            <apex:outputText value="{0, Number, Currency}">
                                                                <apex:param value="{!t.Amount__c }" />
                                                            </apex:outputText>
                                                        </apex:column>
                                                    </apex:dataTable>
                                                </apex:repeat>
                                            </td>
                                            <td class="yearTablees" >
                                                <apex:repeat value="{!MapDepTaxvf[mapAccKey]}" var="tax" >
                                                    <apex:dataTable value="{!tax}" var="t" >
                                                        <apex:column value="{!t.Tax_Name__c}" width="20%" Style="font-size:11px;text-align:left;padding-left:2px;"/>
                                                        <apex:column width="20%"  style="font-size:11px;text-align:right;padding-right:2px;">
                                                            <apex:outputText value="{0, Number, Currency}">
                                                                <apex:param value="{!t.Amount__c}" />
                                                            </apex:outputText>
                                                        </apex:column>
                                                    </apex:dataTable>
                                                </apex:repeat>
                                            </td>
                                            <td class="yearTablees " >
                                                <apex:repeat value="{!MapDepDeductionvf[mapAccKey]}" var="ded" >
                                                    <apex:dataTable value="{!ded}" var="t" >
                                                        <apex:column value="{!t.Deduction_Name__c}" width="20%" Style="font-size:11px;vertical-align:top;padding-left:2px;"/>
                                                        <apex:column width="20%"   Style="font-size:11px;vertical-align:top;padding-right:2px;">
                                                            <apex:outputText value="{0, Number, Currency}">
                                                                <apex:param value="{!t.Amount__c }" />
                                                            </apex:outputText>
                                                        </apex:column>
                                                    </apex:dataTable>
                                                </apex:repeat>
                                            </td>
                                            <td width="20%" Style="font-size:11px;text-align:center;padding-right:5px;">
                                                <apex:repeat value="{!MapDepNetpayvf[mapAccKey]}" var="ded" >
                                                    <apex:dataTable value="{!ded}" var="t" >
                                                        <apex:column width="20%"   Style="font-size:11px;vertical-align:top;padding-right:2px;">
                                                            <apex:outputText value="{0, Number, Currency}">
                                                                <apex:param value="{!t.Amount__c }" />
                                                            </apex:outputText>
                                                        </apex:column>
                                                    </apex:dataTable>
                                                </apex:repeat>
                                            </td> 
                                            
                                            <td class="yearTablees " >
                                                <apex:repeat value="{!MapDepEmpvf[mapAccKey]}" var="tax" >
                                                    <apex:dataTable value="{!tax}" var="t" >
                                                        <apex:column value="{!t.Employer_Name__c}" width="20%" style="font-size:11px;vertical-align:top;padding-left:2px;"/>
                                                        <apex:column width="20%"   style="font-size:11px;vertical-align:top;text-align:right;text-align-last:right;padding-right:2px">
                                                            <apex:outputText value="{0, Number, Currency}">
                                                                <apex:param value="{!t.Amount__c}" />
                                                            </apex:outputText>
                                                        </apex:column>
                                                    </apex:dataTable>
                                                </apex:repeat>
                                            </td>
                                        </tr>
                        
                        <tr>
                            <td class="yearTable" >
                                <apex:variable var="thours" value="{!thours+hours}"/>
                                
                                 
                                           <apex:outputtext value="{!hours}" Style="font-size:11px;text-align:right;padding-right:5px;"/>
                                         
                            </td>
                            <td class="yearTable" > 
                                <apex:variable var="tearning" value="{!tearning+earning}"/>
                                   
                                            
                                                <apex:outputText value="{0, Number, Currency}" style="font-size:11px;text-align:right;padding-left: 150px;">
                                                    <apex:param value="{!earning}" />
                                                </apex:outputText>
                                         
                            </td>
                            <td class="yearTable" >
                                <apex:variable var="tearningnon" value="{!tearningnon+earningnon}"/>
                                 
                                                <apex:outputText value="{0, Number, Currency}" style="font-size:11px;text-align:right;padding-left: 150px;">
                                                    <apex:param value="{!earningnon}" />
                                                </apex:outputText>
                                             
                            </td>
                            <td class="yearTable">
                                <apex:variable var="ttaxes" value="{!ttaxes+taxes}"/>
                                 
                                                <apex:outputText value="{0, Number, Currency}" style="font-size:11px;text-align:right;padding-left: 150px;">
                                                    <apex:param value="{!taxes}" />
                                                </apex:outputText>
                                             
                            </td>
                            <td class="yearTable" >
                                <apex:variable var="tdeductions" value="{!tdeductions+deductions}"/>
                                 
                                                <apex:outputText value="{0, Number, Currency}" style="font-size:11px;text-align:right;padding-left: 70px;">
                                                    <apex:param value="{!deductions}" />
                                                </apex:outputText>
                                             
                            </td>
                            <td class="yearTable" style="text-align:center;">
                                <apex:variable var="tnetpay" value="{!tnetpay+netpay}"/>
                               
                            </td>
                            <td class="yearTable" >
                                <apex:variable var="temployer" value="{!temployer+employer}"/>
                                 
                                                <apex:outputText value="{0, Number, Currency}" style="font-size:11px;text-align:right;padding-left: 150px;">
                                                    <apex:param value="{!employer}" />
                                                </apex:outputText>
                                             
                            </td>
                        </tr>
                        <br/>
                    </table> 
                </div>
                <apex:variable value="{!count+1}" var="count"/>
            </apex:repeat> 
            
            Company Totals:
            
            <table border="1" cellspacing="0"  cellpadding="0"  width="100%" style="min-height:14px !important;" rendered="{!if(AggreSize==4,true,false)}" >
                <table   border="1" cellspacing="0"  cellpadding="0"  width="100%" style="min-height:14px !important; " >
                    <tr >
                        <th  align="center" colspan="2" bgcolor="#00245F" style="color:white; font-size:14px;">Pay Period &nbsp;&nbsp; <apex:outputText value="{!BZP__PayPeriod__c.name}"  Style="font-size:14px;text-align:center;"></apex:outputText></th>
                        <th  align="center" colspan="2" bgcolor="#00245F" style="color:white; font-size:14px;">Total No of Workers &nbsp;&nbsp; <apex:outputText value="{!rowNumber}"  Style="font-size:14px;text-align:center;"></apex:outputText></th>
                        <th  align="center" colspan="3" bgcolor="#00245F" style="color:white; font-size:14px;">Total No of Projects &nbsp;&nbsp; <apex:outputText value="{!count}"  Style="font-size:14px;text-align:center;"></apex:outputText></th>
                    </tr>
                    
                    <tr style=" page-break-inside: avoid;" >
                        <!--<th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Count</th>-->
                        <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Hours </th>
                        <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Taxable Earnings  </th>
                        <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Non Taxable Earnings   </th>
                        <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Taxes</th>
                        <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Deductions </th>
                        <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Net Pay </th>
                        <th  align="center" bgcolor="#00245F" style="color:white; font-size:14px;">Employers</th>
                    </tr>
                    <tr>
                        <td style="background-color: #D3D3D3;" class="yearTablees">
                            <apex:dataTable value="{!Maptotal['Earning']}" var="r">
                                <apex:column value="{!r.Name}" Style="font-size:11px;"/>
                                <apex:column value="{!r.Hour}" Style="font-size:11px;text-align:right !important;"/>
                            </apex:dataTable>
                        </td>
                        <td style="background-color: #D3D3D3;" class="yearTablees">
                            <apex:dataTable value="{!Maptotal['Earning']}" var="r">
                                <apex:column value="{!r.Name}" Style="font-size:11px;"/>
                                <apex:column Style="font-size:11px;text-align:right !important;">
                                    <apex:outputText value="{0, Number, Currency}" Style="font-size:11px;text-align:right !important;">
                                        <apex:param value="{!r.Amount}" />
                                    </apex:outputText>
                                </apex:column>
                            </apex:dataTable>
                        </td>
                        <td style="background-color: #D3D3D3;" class="yearTablees">
                            <apex:dataTable value="{!Maptotal['Earningnontax']}" var="r">
                                <apex:column value="{!r.Name}" Style="font-size:11px;"/>
                                <apex:column Style="font-size:11px;text-align:right !important;">
                                    <apex:outputText value="{0, Number, Currency}" Style="font-size:11px;text-align:right !important;">
                                        <apex:param value="{!r.Amount}" />
                                    </apex:outputText>
                                </apex:column>
                            </apex:dataTable>
                        </td>
                        <td style="background-color: #D3D3D3;" class="yearTablees">
                            <apex:dataTable value="{!Maptotal['Taxes']}" var="r">
                                <apex:column value="{!r.Name}" Style="font-size:11px;"/>
                                <apex:column Style="font-size:11px;text-align:right !important;">
                                    <apex:outputText value="{0, Number, Currency}" Style="font-size:11px;">
                                        <apex:param value="{!r.Amount}" />
                                    </apex:outputText>
                                </apex:column>
                            </apex:dataTable>
                        </td>
                        <td style="background-color: #D3D3D3;" class="yearTablees">
                            
                            <apex:dataTable value="{!Maptotal['Deductions']}" var="r">
                                <apex:column value="{!r.Name}" Style="font-size:11px;"/>
                                <apex:column Style="font-size:11px;text-align:right !important;">
                                    <apex:outputText value="{0, Number, Currency}" Style="font-size:11px;">
                                        <apex:param value="{!r.Amount}" />
                                    </apex:outputText>
                                </apex:column>
                            </apex:dataTable>                            
                        </td>
                        <td style="background-color: #D3D3D3;text-align:center;" class="yearTabls">
                            
                                                         
                         <apex:outputText value="{0, Number, Currency}"  Style="font-size:11px;text-align:center;">
                                            <apex:param value="{!tnetpay}" />
                                        </apex:outputText>
                                            
                        </td>
                        <td style="background-color: #D3D3D3;" class="yearTablees">
                            
                            <apex:dataTable value="{!Maptotal['Employers']}" var="r">
                                <apex:column value="{!r.Name}" Style="font-size:11px;"/>
                                <apex:column Style="font-size:11px;text-align:right !important;">
                                    <apex:outputText value="{0, Number, Currency}" Style="font-size:11px;">
                                        <apex:param value="{!r.Amount}" />
                                    </apex:outputText>
                                </apex:column>
                            </apex:dataTable>
                        </td>
                    </tr>
                   
                   
                   
                   
                    <tr>
                        <td class="yearTable" style="background-color: #D3D3D3;">
                         
                           <apex:outputtext value="{!thours}" Style="font-size:11px;text-align:right !important;"/>
                          <!--
                            <table style="font-size:11px;text-align:right !important;">
                                <tbody style="font-size:11px;text-align:right !important;">
                                    <tr style="font-size:11px;text-align:right !important;">
                                        <td style="font-size:11px;text-align:right !important;"></td>
                                        <td style="font-size:11px;text-align:right !important;"></td>
                                        <td style="font-size:11px;text-align:right !important;">
                                            <apex:outputtext value="{!thours}" Style="font-size:11px;text-align:right !important;"/>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            -->
                            
                        </td>
                        <td class="yearTable" style="background-color: #D3D3D3;">
                            <apex:outputText value="{0, Number, Currency}"  style="font-size:11px;text-align:right !important;">
                                                <apex:param value="{!tearning}" />
                                            </apex:outputText>
                            
                        </td>
                         <td class="yearTable" style="background-color: #D3D3D3;">
                            <apex:outputText value="{0, Number, Currency}"  style="font-size:11px;text-align:right !important;">
                                                <apex:param value="{!tearningnon}" />
                                            </apex:outputText>
                            
                        </td>
                        <td class="yearTable" style="background-color: #D3D3D3;">
                           
                            <apex:outputText value="{0, Number, Currency}"  style="font-size:11px;text-align:right !important;">
                                                <apex:param value="{!ttaxes}" />
                                            </apex:outputText>
                                            
                           
                        </td>
                        <td class="yearTable" style="background-color: #D3D3D3;" >
                         <apex:outputText value="{0, Number, Currency}"  style="font-size:11px;text-align:right !important;">
                                                <apex:param value="{!tdeductions}" />
                                            </apex:outputText>
                              
                        </td>
                        <td class="yearTable" style="background-color: #D3D3D3;text-align:right !important;">
                           
                            
                        </td>
                        <td class="yearTable" style="background-color: #D3D3D3;">
                            
                             <apex:outputText value="{0, Number, Currency}"  style="font-size:11px;text-align:right !important;">
                                                <apex:param value="{!temployer}" />
                                            </apex:outputText>
                                            
                           
                        </td>
                    </tr>
                </table>
                <br/>
            </table>
        </table>
    </div>
</body>  
</apex:page>